(this["webpackJsonpreact-flow"]=this["webpackJsonpreact-flow"]||[]).push([[0],{140:function(e,t,n){e.exports=n(342)},341:function(e,t,n){},342:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(27),i=n.n(r),c=n(7),l=n(34),u=n(1),d=n(28),s=n(6),p=n(76),m=n.n(p),f=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new m.a.graphlib.Graph;n.setDefaultEdgeLabel((function(){return{}}));var a=function(e){Object(c.d)(e)?n.setNode(e.id,{width:170,height:45}):n.setEdge(e.source,e.target)},o=e.filter((function(e){return e.loopback}));e=e.filter((function(e){return!(null===e||void 0===e?void 0:e.loopback)})),n.setGraph({rankdir:"TB",align:"UL"}),e.forEach(a),m.a.layout(n);var r=e.map((function(e){if(Object(c.d)(e)){var a;e.targetPosition="top",e.sourcePosition="bottom";var o=0;if("transition"!==(null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.type)&&"output"!==(null===e||void 0===e?void 0:e.type)||(o=50),"input"===(null===e||void 0===e?void 0:e.type)&&(o=25),t){console.log("using auto coords");var r=n.node(e.id),i=r.x,l=r.y;e.position={x:i,y:l}}else console.log("using existing coords"),e.position={x:e.position.x/4-o,y:e.position.y/3}}return e}));return[].concat(Object(d.a)(r),Object(d.a)(o))},b=Object(a.memo)((function(e){var t=e.data,n=e.isConnectable,a=void 0===n||n;return o.a.createElement("div",{style:{padding:"0.5rem 2rem",width:170}},o.a.createElement(c.a,{id:"target",type:"target",position:"top",isConnectable:a}),o.a.createElement("div",null,t.label),o.a.createElement(c.a,{type:"source",position:"bottom",isConnectable:a}))})),g={border:"1px solid #eee",boxShadow:"0px 2px 8px rgba(8, 35, 48, 0.14)",borderRadius:"8px",fontSize:12,color:"#222",background:"#fff",padding:10,width:170,textAlign:"center"},v=Object(a.memo)((function(e){var t=e.data,n=e.isConnectable,a=void 0===n||n;return o.a.createElement("div",{style:g},o.a.createElement(c.a,{type:"target",position:"top",isConnectable:a}),o.a.createElement("div",null,t.label),o.a.createElement(c.a,{id:"source",type:"source",position:"bottom",isConnectable:a}),o.a.createElement(c.a,{id:"loopback",type:"source",position:"right",isConnectable:a}))})),y={input:{background:"#eafce3",border:0,width:170},output:{background:"#ffe6e6",border:0,width:170},transition:{background:"#e5efff",paddingTop:"0.45rem",paddingBottom:"0.45rem",border:0,width:170},default:{border:"1px solid #eee",boxShadow:"0px 2px 8px rgba(8, 35, 48, 0.14)",borderRadius:"8px",width:170}},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return e.length<=t?e:e.substring(0,t)+"..."},h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{id:"e".concat(e).concat(t),source:e,target:t,type:"smoothstep",sourceHandle:n?"loopback":"source",loopback:n,animated:n,data:{type:"link"}}},k=function(e){var t=[];return e.step.forEach((function(e){return t.push(function(e){var t=/INITIALSTEP/gi.test(e.name)?"input":/TERMINALSTEP/gi.test(e.name)?"output":"step";return{id:e.name,type:t,data:{label:E(e.name),ref:e,type:"step"},style:y[t],position:{x:e.x,y:e.y}}}(e))})),e.transition.forEach((function(e){return t.push({id:(n=e).name,type:"default",data:{label:E(n.expression||n.name),ref:n,type:"transition"},style:y.transition,position:{x:n.x,y:n.y}});var n})),e.link.forEach((function(n){var a=function(e,t){var n,a,o,r,i=e.from_type,c=e.from_name,l=e.to_name;return 21===i?(o=t.step.find((function(e){return e.name===c})),r=t.transition.find((function(e){return e.name===l}))):(o=t.transition.find((function(e){return e.name===c})),r=t.step.find((function(e){return e.name===l}))),(null===(n=r)||void 0===n?void 0:n.y)<(null===(a=o)||void 0===a?void 0:a.y)&&(console.log("isLoopback!!!",c,"=>",l,{source:o,target:r}),!0)}(n,e);t.push(h(n.from_name,n.to_name,a))})),console.log({recipe:e}),t},x=n(139),j=n.n(x).a.create({baseURL:"https://sw-recipe-builder-dev.azurewebsites.net/"}),O=[function(e){return j("recipe/".concat(e))},function(e){return j("unit_procedure/".concat(e))},function(e){return j("operation/".concat(e))}],w=function(e){var t=e.recipeType,n=void 0===t?0:t,r=Object(u.f)(),i=Object(u.g)().id,l=Object(a.useState)(!1),p=Object(s.a)(l,2),m=p[0],g=p[1],y=Object(a.useState)(null),E=Object(s.a)(y,2),x=E[0],j=E[1],w=Object(a.useState)(null),T=Object(s.a)(w,2),_=T[0],S=T[1],C=Object(a.useState)(null),L=Object(s.a)(C,2),N=L[0],R=L[1];o.a.useEffect((function(){var e=O[n];e&&e(i).then((function(e){var t=e.data;console.log("fetch remote data",t),j(t),R(f(k(t),m))})).catch(console.log)}),[]);Object(a.useCallback)((function(){if(_){var e=_.toObject();console.log(e)}}),[_]);return console.log("recipe state",{id:i,recipeType:n,recipe:x,elements:N}),N?o.a.createElement("div",{className:"layoutflow",key:"".concat(i,"-").concat(n)},o.a.createElement(c.c,{nodesDraggable:!0,elements:N,onConnect:function(e){var t=e.source,n=e.target,a=e.sourceHandle,o=h(t,n,"loopback"===a);R((function(e){return f([].concat(Object(d.a)(e),[o]))}))},onElementsRemove:function(e){R((function(t){return Object(c.e)(e,t)}))},connectionLineType:"step",onLoad:S,onNodeDoubleClick:function(e,t){var a,o=t.type,i=t.data;if("step"===o&&(null===i||void 0===i||null===(a=i.ref)||void 0===a?void 0:a.link_id)){var c;switch(n){case 0:c="unit_procedure";break;case 1:c="operation"}if(c){var l=i.ref.link_id;r("/".concat(c,"/").concat(l))}}},nodeTypes:{step:v,transition:b}}),o.a.createElement("div",{className:"save__controls",style:{position:"absolute",top:0,right:0,padding:20,zIndex:9999,background:"#eee",color:"#999"}},o.a.createElement("button",{onClick:function(){console.log("toggle layout",!m),g((function(e){return!e})),R(Object(d.a)(f(k(x),!m)))}},"layout: ",m?"auto":"existing"))):o.a.createElement("div",{className:"layoutflow",style:{textAlign:"center",padding:"10rem"}},"Loading...")};function T(){var e=Object(a.useState)([]),t=Object(s.a)(e,2),n=t[0],r=t[1];return o.a.useEffect((function(){j("recipe").then((function(e){var t=e.data;r(t)})).catch(console.log)}),[]),o.a.createElement("div",{style:{padding:"10rem"}},o.a.createElement("h2",null,"Recipes list"),o.a.createElement("ul",{id:"recipe-list"},n.map((function(e){var t=e.id,n=e.name;return o.a.createElement("li",{key:"link-".concat(t,"-").concat(n)},o.a.createElement(l.b,{to:"/recipe/".concat(t)},n))}))),o.a.createElement("div",{style:{marginTop:"3rem",maxWidth:"35%",padding:"1.4rem",background:"#e0ffe0",lineHeight:"1.4rem",borderRadius:4}},"Note: You can drill down into a STEP by double clicking on it. Navigate using your browser forward / back buttons."))}function _(){return o.a.createElement(l.a,null,o.a.createElement(u.c,null,o.a.createElement(u.a,{path:"/",element:o.a.createElement(T,null)}),o.a.createElement(u.a,{path:"/recipe",element:o.a.createElement(T,null)}),o.a.createElement(u.a,{path:"/recipe/:id",element:o.a.createElement(w,{key:"recipe",recipeType:0})}),o.a.createElement(u.a,{path:"/unit_procedure/:id",element:o.a.createElement(w,{key:"unit_procedure",recipeType:1})}),o.a.createElement(u.a,{path:"/operation/:id",element:o.a.createElement(w,{key:"operation",recipeType:2})})))}n(341);var S=document.getElementById("root");i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(c.b,null,o.a.createElement(_,null))),S)}},[[140,1,2]]]);
//# sourceMappingURL=main.66749fdd.chunk.js.map